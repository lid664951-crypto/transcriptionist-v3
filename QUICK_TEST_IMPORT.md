# 快速测试：导入性能优化

## 🎯 测试目标
验证6000个文件导入是否使用独立子进程，速度是否提升。

---

## 📋 测试步骤

### 1. 准备测试文件
- 准备6000个音频文件（WAV、MP3、FLAC等）
- 放在一个文件夹中

### 2. 启动软件并导入
1. 启动 Transcriptionist v3
2. 进入"音效库"页面
3. 点击"导入"按钮
4. 选择包含6000个文件的文件夹
5. 观察进度和时间

### 3. 检查日志
在控制台中查找以下关键日志：

**✅ 成功的日志（使用独立子进程）：**
```
INFO: 扫描完成，共 6000 个音频文件，开始元数据提取
INFO: 元数据提取：独立子进程 (≥1000)
INFO: Starting parallel metadata extraction batch 1/1 (6000 files)
```

**❌ 失败的日志（仍使用进程内多进程）：**
```
INFO: 元数据提取：进程内多进程 (100~1000)
```

---

## ⏱️ 预期时间

### 优化后（独立子进程）
- **扫描阶段**：1-2分钟
- **元数据提取**：3-6分钟
- **总时间**：4-8分钟

### 优化前（进程内多进程）
- **扫描阶段**：1-2分钟
- **元数据提取**：10-15分钟
- **总时间**：11-17分钟

**预期提升**：速度提升 **2-3倍**

---

## 🔍 验证清单

- [ ] 控制台日志显示"元数据提取：独立子进程 (≥1000)"
- [ ] CPU利用率接近100%（在任务管理器中查看）
- [ ] 导入时间在4-8分钟之间（SSD硬盘）
- [ ] 没有出现"Timeout"或"falling back"错误
- [ ] 所有6000个文件都成功导入

---

## 📊 性能对比表

| 指标 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| 元数据提取方式 | 进程内多进程 | 独立子进程 | - |
| 元数据提取时间 | 10-15分钟 | 3-6分钟 | 2-3倍 |
| CPU利用率 | 40-60% | 80-100% | 2倍 |
| 总导入时间 | 11-17分钟 | 4-8分钟 | 2-3倍 |

---

## 🐛 如果测试失败

### 情况1：仍然显示"进程内多进程"
**原因**：代码修改未生效

**解决方案**：
1. 确认文件已保存
2. 重启软件
3. 检查 `library_page_qt.py` 中的 `SUBPROCESS_THRESHOLD` 是否为 1000

### 情况2：导入时间没有明显提升
**可能原因**：
- 使用机械硬盘（HDD）而不是SSD
- CPU性能较弱
- 其他程序占用资源

**解决方案**：
- 升级到SSD硬盘（最重要！）
- 关闭其他占用CPU的程序
- 在设置中调整"库扫描并行数"

### 情况3：出现错误或卡住
**可能原因**：
- 某些音频文件损坏
- 内存不足
- 硬盘空间不足

**解决方案**：
- 检查控制台日志中的错误信息
- 确保有足够的内存（建议8GB+）
- 确保有足够的硬盘空间

---

## 📝 测试报告模板

请在测试后填写以下信息：

```
### 测试环境
- CPU: [例如：Intel i7-10700]
- 内存: [例如：16GB]
- 硬盘: [例如：NVMe SSD / SATA SSD / HDD]
- 文件数量: [例如：6000]
- 文件格式: [例如：WAV, MP3]

### 测试结果
- 扫描时间: [例如：1分30秒]
- 元数据提取时间: [例如：4分钟]
- 总时间: [例如：5分30秒]
- CPU利用率: [例如：90%]

### 日志关键信息
```
[粘贴控制台日志中的关键行]
```

### 是否成功
- [ ] 是，速度明显提升
- [ ] 否，仍然很慢

### 问题描述（如果有）
[描述遇到的问题]
```

---

## ✅ 成功标准

测试成功的标准：
1. ✅ 日志显示使用"独立子进程"
2. ✅ CPU利用率达到80%以上
3. ✅ 6000文件导入时间在4-8分钟之间（SSD）
4. ✅ 没有错误或警告
5. ✅ 所有文件成功导入

如果满足以上5个条件，说明优化成功！

---

**测试准备完成**  
**等待用户测试验证**  
**预期提升：2-3倍速度**
