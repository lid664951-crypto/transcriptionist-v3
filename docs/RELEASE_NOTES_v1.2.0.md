# 音译家 AI 音效管理工具 v1.2.0 发布说明（重构版）

> 版本定位：UI 框架重做 + 百万级实时索引架构升级

## 版本信息

- 版本号：`v1.2.0`
- 发布类型：`Major`（架构重构）
- 计划发布时间：`2026-03`（以集成测试与性能验收为准）

---

## 这次版本要解决什么

`v1.2.0` 不再是“小修小补”，而是围绕以下目标进行重构：

- UI 从“功能拼接”升级为统一现代化工作台（参考 Soundly 的信息架构与交互节奏）。
- 索引从“批处理可用”升级为“百万级持续实时更新”。
- 数据存储保持 SQLite 主线，同时把检索和索引链路做任务化分层。

---

## 核心更新（Highlights）

### 1) UI 工作台重做（Soundly 风格方向）

- 新版三栏工作台：
  - 左侧：资源导航（库、标签、项目、在线资源）。
  - 中央：主工作区（列表、搜索结果、任务流）。
  - 底部：统一播放与波形交互区。
- 视觉系统统一：间距、圆角、层级阴影、状态色、字体比例统一到设计令牌。
- 交互状态统一：导入、索引、搜索、打标、翻译均使用统一任务状态组件。
- 列表渲染升级：大库场景下保持平滑滚动与渐进加载。

### 1.1) 双向全屏工作模式（音效库 / 工作台）

- 新增三态布局：`Split`（分栏）、`LibraryFocus`（音效库聚焦）、`WorkbenchFocus`（工作台聚焦）。
- 中间分隔位置箭头按钮支持双向聚焦切换：
  - 一键聚焦音效库。
  - 一键聚焦工作台。
  - 再次切换恢复分栏。
- 模式切换不销毁页面实例，保持当前筛选、选择、滚动位置与任务进度。
- 全屏聚焦时底部播放器与波形条持续可用，不中断试听和定位。

### 2) 百万级“绝对实时索引”架构升级

- 引入实时增量索引管线：
  - 文件事件（新增/改名/删除）进入队列。
  - 元数据、全文检索、向量索引异步并行更新。
  - 前台查询优先命中新索引，保障结果“准实时可见”。
- 建立可恢复任务系统：任务中断后支持 checkpoint 恢复。
- 分片与合并策略升级：避免全量重建，优先增量写入与后台合并。

### 3) 数据库与检索引擎分层

- 关系数据库层：存放业务主数据与事务状态。
- 全文检索层：服务毫秒级文本过滤与排序。
- 向量检索层：服务语义检索与相似匹配。
- 通过统一查询编排层合并结果，保证相关性与可解释性。

#### 当前实现进度（阶段1）

- 已收敛为 SQLite 单后端（对齐 Soundly 方向）。
- 已支持环境变量覆盖 SQLite URL（仅接受 `sqlite://`）。
- 已加入数据库健康检查（启动阶段快速失败，减少隐性错误）。

#### 当前实现进度（阶段2）

- 已移除 `SQLite -> PostgreSQL` 迁移脚本，避免路线分叉。
- 已将 `migrate_db.py` 统一为 SQLite 初始化/迁移入口。

#### 当前实现进度（阶段3）

- 已接入 Alembic 版本化迁移骨架。
- 已提供 `upgrade/downgrade/stamp/current/revision` 命令脚本。
- 已提供 Alembic 工作流文档，聚焦 SQLite 结构版本迁移。

### 4) 导入与监控链路重构

- 导入流程支持后台运行与任务面板可视化。
- 文件夹监控正式接线，增量变更自动入库与自动索引。
- 批量导入时优先保证 UI 可交互与任务可取消。

### 5) 波形与播放体验升级

- 波形提取从单格式保守策略升级为安全多格式策略。
- 波形缓存接入播放链路，重复预览命中缓存。
- 波形与播放位置联动保持稳定，seek 交互更顺滑。

---

## 与 Soundly 对标后落实的方向

基于反编译学习与现有代码现状，本版本重点对齐以下能力：

- 对齐 Soundly 的“分页/切片加载思路”，避免一次性构建大体量 UI 节点。
- 对齐 Soundly 的“导入后台化 + 进度状态机”。
- 对齐 Soundly 的“文件监控 + 防抖合并”机制。
- 对齐 Soundly 的“多源结果并发聚合”搜索策略。

---

## 用户可感知变化

- 界面更现代，信息层次更清晰，操作路径更连贯。
- 音效库与工作台都可一键聚焦，全屏专注浏览或处理任务。
- 大库（10 万~100 万）下依然可快速开始浏览与搜索。
- 导入、索引、搜索任务都可见、可控、可恢复。
- 文件变化后无需频繁手动重扫，系统自动增量更新。

---

## 兼容性说明

- 兼容 `v1.1.x` 数据迁移。
- 首次升级会执行索引结构迁移与重建流程。
- 建议升级前备份 `data` 与 `config` 目录。

---

## 已知事项

- 百万级首次建库仍需较长后台时间，但不阻塞主流程。
- 不同机器硬件差异会影响“实时性上限”，系统会按设备能力自动调整并发策略。
